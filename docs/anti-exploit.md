# Anti-Exploit Mechanisms

## Overview

An economy system must be resilient against exploits, cheating, and abuse. This document covers security measures to protect the economy's integrity.

## Exploit Categories

### 1. Money Duplication
### 2. Infinite Money Generation
### 3. Tax Evasion
### 4. Bank Fraud
### 5. Transaction Exploits
### 6. System Gaming
### 7. Social Engineering
### 8. Server Abuse

---

## 1. Money Duplication Exploits

### Threats

**Transaction Timing:**
- Exploiting lag to duplicate withdrawals
- Simultaneous transactions creating duplicates
- Race conditions in database

**Database Manipulation:**
- Direct database edits (if accessible)
- SQL injection attacks
- Backup restoration exploits

### Protections

**Atomic Transactions:**
```
All money transfers must be atomic:
- Check balance
- Deduct amount
- Add to recipient
- All or nothing (no partial failures)
```

**Server-Side Validation:**
```
NEVER trust client:
- All balance checks server-side
- All transactions server-side
- No client-side money storage
```

**Transaction Locking:**
```
When player initiates transaction:
- Lock player account
- Process transaction
- Unlock account
- Prevents concurrent exploit
```

**Unique Transaction IDs:**
```
Every transaction gets unique ID:
- Prevents replay attacks
- Audit trail
- Can reverse if needed
```

**Database Security:**
- Encrypted database
- Access controls
- Regular integrity checks
- Checksums for critical data

**Logging:**
```
Log all transactions:
- Timestamp
- Player IDs
- Amount
- Type
- Source/Destination
- Transaction hash
```

---

## 2. Infinite Money Generation

### Threats

**Gold Mining Exploits:**
- AFK mining bots
- Speed hacks (mine faster)
- Duplication of gold items
- Respawn manipulation

**Job Salary Exploits:**
- Clock in/out spam
- Time manipulation
- Multiple simultaneous jobs
- Fake work hours

**Business Exploits:**
- Fake revenue reporting
- Infinite NPC purchases
- Price manipulation

### Protections

**Mining Rate Limits:**
```
Per player per hour:
- Maximum gold: 200 bars
- Tracked server-side
- Resets on timer
- Exceeding limit = ban warning
```

**Active Mining Requirements:**
```
Mining requires:
- Active input (not just holding key)
- Random challenges (click prompt)
- AFK detection (30 seconds inactive = stop)
- Captcha-like verification
```

**Gold Item Tracking:**
```
Each gold bar:
- Unique ID
- Creation timestamp
- Creator player ID
- Transaction history
- Cannot be duplicated (server validates)
```

**Salary Controls:**
```
Job salaries:
- Require active gameplay
- Performance checks
- Supervisor validation (for police, etc.)
- Maximum hours per day
- Clock-in location verification
```

**Anti-Speed Hack:**
```
Server-side timing:
- Mining takes X seconds (server decides)
- Client cannot speed up
- Server validates timing
- Suspicious speed = kick/ban
```

**Business Revenue Auditing:**
```
Track business transactions:
- Compare reported vs actual
- Flag inconsistencies
- Require receipts/logs
- Random audits
```

---

## 3. Tax Evasion

### Threats

**Underreporting Income:**
- Hiding revenue
- Fake expenses
- Off-books transactions

**Asset Hiding:**
- Transferring to alt accounts
- Selling before assessment
- Using shell companies

**Tax Haven Abuse:**
- Exploiting low-tax zones
- Fake residency

### Protections

**Automatic Tax Collection:**
```
Most taxes automatic:
- Income tax: Withheld from paycheck
- Sales tax: Added at purchase
- Property tax: Auto-deducted from bank
- Reduces evasion opportunity
```

**Transaction Monitoring:**
```
Government can track:
- All large transactions (>$50,000)
- Patterns suggesting hidden income
- Discrepancies in lifestyle vs. reported income
```

**Random Audits:**
```
Audit system:
- Random selection (5% of players/year)
- High-earner targeting (audit rich more often)
- Suspicious activity flagging
- Review transaction logs
- Compare income sources vs. reported
```

**Penalties:**
```
Tax evasion consequences:
- Fine: 2x owed amount
- Jail time (in-game)
- Asset seizure
- Criminal record (affects credit)
- Permanent flag
```

**Alt Account Prevention:**
```
Link accounts:
- Hardware ID
- IP address
- Family sharing detection
- Shared bank accounts flagged
```

**Cross-Reference Data:**
```
Government systems check:
- Bank deposits vs. reported income
- Property purchases vs. declared wealth
- Business revenue vs. sales tax collected
```

---

## 4. Bank Fraud

### Threats

**Fractional Reserve Abuse:**
- Lending beyond reserve requirements
- Fake deposits
- Phantom accounts

**Loan Fraud:**
- Taking loans with no intent to repay
- Alt accounts taking loans
- Fake collateral

**Owner Theft:**
- Bank owner stealing depositor funds
- Embezzlement
- Running with money

### Protections

**Enforced Reserve Requirements:**
```
Federal Reserve monitors:
- Real-time reserve ratio
- Automatically restrict if below requirement
- Cannot issue loans below ratio
- Daily compliance checks
```

**Deposit Insurance:**
```
Government-backed insurance:
- Covers up to $50,000 per account
- Funded by bank premiums
- Prevents total loss
- Encourages trust
```

**Separation of Funds:**
```
Bank database:
- Owner funds separate from deposits
- Owner cannot directly access deposits
- Only through loan/withdrawal mechanisms
- Audit trail for all movements
```

**Collateral Validation:**
```
Loans require collateral:
- Server validates collateral exists
- Locks collateral until repaid
- Automatically seizes if default
- Cannot fake or duplicate collateral
```

**Credit Checks:**
```
Prevent loan fraud:
- Check credit score
- Review past loans
- Verify identity (not alt)
- Limit loans per player
```

**Bankruptcy Protection:**
```
If bank fails:
- Federal Reserve takes over
- Deposits up to limit returned
- Remaining assets liquidated
- Owner loses investment
- Prevents "run and hide" scams
```

---

## 5. Transaction Exploits

### Threats

**Trade Scams:**
- Fake trades (bait and switch)
- Partial payments
- Chargebacks

**Wire Transfer Fraud:**
- Sending to wrong account (claim accident)
- Fake payment confirmations
- Man-in-the-middle attacks

**Refund Abuse:**
- Claiming false refunds
- Duplicate refund requests

### Protections

**Trade Confirmation:**
```
Secure trade system:
- Both parties confirm
- Show exactly what's traded
- Lock-in period (5 seconds to review)
- Finalize = irreversible
```

**No Chargebacks:**
```
All transactions final:
- No refunds unless both parties agree
- Or admin intervention for verified scams
- Clear warnings before confirming
```

**Wire Transfer Receipts:**
```
Every transfer generates:
- Unique transaction ID
- Timestamp
- From/To visible
- Amount
- Both parties notified
```

**Escrow System (Optional):**
```
For large trades:
- Third party holds payment
- Confirms both sides deliver
- Releases payment when complete
- Fee for service
```

**Transaction Limits:**
```
Anti-fraud limits:
- Max wire transfer: $1,000,000/transaction
- Daily limit: $5,000,000
- Requires verification for larger
```

**Fraud Reporting:**
```
Players can report:
- Scam attempts
- False trades
- Suspicious activity
- Admin investigation
- Penalties for verified fraud
```

---

## 6. System Gaming

### Threats

**Market Manipulation:**
- Price fixing
- Monopolies
- Insider trading (if stocks exist)

**Government Corruption:**
- Elected officials embezzling
- Awarding contracts to friends
- Tax manipulation for favors

**Insurance Fraud:**
- Fake claims
- Intentional damage
- Staged incidents

### Protections

**Anti-Trust Regulations:**
```
Prevent monopolies:
- Limit businesses per player (e.g., 3 max)
- Anti-collusion rules
- Government can break up monopolies
- Encourage competition
```

**Government Audits:**
```
Elected officials monitored:
- All transactions public
- Budget transparency
- Cannot transfer to personal account
- Admin oversight
- Impeachment for violations
```

**Contract Transparency:**
```
Government contracts:
- Public bidding process
- Lowest/best bid wins
- Justification required for non-lowest
- Community can review
```

**Insurance Verification:**
```
Insurance claims:
- Require evidence (screenshots, logs)
- Investigate suspicious patterns
- Deny fraudulent claims
- Ban repeat offenders
```

**Price Controls (Emergency):**
```
If market manipulation:
- Government can set price caps
- Regulate essential goods
- Fine price gougers
- Temporary measure
```

---

## 7. Social Engineering

### Threats

**Impersonation:**
- Pretending to be admin
- Fake government officials
- Bank employee scams

**Phishing:**
- Fake bank websites
- Fake payment requests

**Confidence Scams:**
- Ponzi schemes
- Fake investment opportunities
- "Get rich quick" scams

### Protections

**Official Verification:**
```
Government/Admin identification:
- Special tags/badges (in-game)
- Verified roles
- Official communication channels
- Warn players never to share passwords
```

**Player Education:**
```
Tutorials/Warnings:
- How to spot scams
- Never give out personal info
- Verify before paying
- Report suspicious activity
```

**Ponzi Detection:**
```
Flag suspicious patterns:
- "Investment" promising guaranteed returns
- Pyramid-like structures
- Unusually high interest rates
- Admin review
```

**Reporting System:**
```
Easy scam reporting:
- In-game report button
- Admin review queue
- Evidence collection
- Penalties for verified scammers
```

---

## 8. Server Abuse

### Threats

**Alt Account Farming:**
- Multiple accounts mining
- Transfer wealth to main
- Bypass limits

**Bot Networks:**
- Automated mining
- Automated trading
- Artificial inflation

**Server Hopping:**
- Exploit different server economies
- Arbitrage between servers

### Protections

**Alt Account Detection:**
```
Track identifiers:
- Hardware ID
- IP address
- Behavioral patterns
- Login times
- Similar names
- Flagged for review
```

**New Account Limits:**
```
Restrictions on fresh accounts:
- Cannot trade for 24 hours
- Limited transactions
- Lower mining rate
- Graduated access
```

**Bot Detection:**
```
Anti-bot measures:
- Captcha-like challenges
- Pattern detection (too perfect)
- Inhuman reaction times
- Repetitive actions
- AFK checks
```

**Server-Specific Economies:**
```
If multiple servers:
- No cross-server trading
- Separate economies
- Prevents arbitrage
- Each server balanced independently
```

**Rate Limiting:**
```
Prevent spam/automation:
- Transaction cooldowns
- Action limits per minute
- Gradual unlocks for new accounts
```

---

## Administrative Tools

### Detection Dashboard

**Monitors:**
- Unusual money spikes (investigate)
- Rapid wealth accumulation
- Suspicious transaction patterns
- Multiple accounts from same IP
- Bot-like behavior
- Tax evasion red flags

**Alerts:**
- Player gained $1M+ in 1 hour (investigate)
- New account with high wealth
- Bank reserve violation
- Unusual trade patterns
- Duplicate transactions

### Investigation Tools

**Admin Commands:**
```
/eco inspect <player>
  - View all transactions
  - View wealth history
  - View owned assets
  - View connected accounts

/eco audit <player>
  - Full financial audit
  - Income vs. spending
  - Tax compliance
  - Loan history

/eco rollback <transaction_id>
  - Reverse fraudulent transaction
  - Return money to victim
  - Flag exploiter

/eco ban <player> <reason>
  - Ban for economic exploits
  - Optional: seize assets
  - Redistribute to victims
```

### Transaction Logs

**Store:**
- All transactions (permanent)
- All money creation events
- All money destruction events
- All database changes
- Timestamped and hashed

**Search:**
- By player
- By amount
- By date range
- By transaction type
- By suspicious patterns

### Economic Reports

**Daily Reports:**
- Money supply change
- Largest transactions
- New millionaires
- Suspicious activity
- System health

**Weekly Reports:**
- Economic trends
- Inflation/deflation
- Wealth distribution
- Top earners
- Audit results

---

## Player Reporting

### In-Game Report System

**Report Types:**
- Money exploit
- Tax evasion
- Bank fraud
- Scam attempt
- Market manipulation

**Report Process:**
```
1. Player clicks "Report"
2. Selects type
3. Provides evidence (screenshot, description)
4. Submits to admin queue
5. Admin investigates
6. Action taken (warn, ban, rollback)
7. Reporter notified of outcome
```

**Rewards:**
```
Bounty for verified reports:
- $10,000 for catching exploiter
- Encourages community policing
- Must be verified by admin
```

---

## Punishment System

### Severity Levels

**Level 1: Warning**
- First-time minor offense
- Log incident
- Warning message
- No other penalty

**Level 2: Fine**
- Moderate offense
- Fine = 2x amount gained/evaded
- Temporary flag
- Second offense = harsher

**Level 3: Asset Seizure**
- Serious offense
- Seize ill-gotten gains
- Jail time (in-game)
- Permanent criminal record

**Level 4: Ban**
- Severe/repeat offenses
- Account ban (temporary or permanent)
- Hardware ban if repeated
- Assets wiped

### Appeal Process

**Players can appeal:**
- Submit appeal ticket
- Provide counter-evidence
- Admin review
- Decision final

**False Accusations:**
- Investigate accusers too
- Punish false reports (if malicious)
- Protect innocent players

---

## Preventive Design

### Economy Design Principles

**Minimize Trust:**
- Server validates everything
- Client is never trusted
- All calculations server-side

**Minimize Complexity:**
- Simpler systems = fewer exploits
- Clear rules
- Transparent mechanics

**Balance Risk/Reward:**
- High rewards = high scrutiny
- Low rewards = lower exploit value
- Make exploiting not worth it

**Regular Audits:**
- Automated daily checks
- Random player audits
- System health monitoring

**Community Involvement:**
- Players report exploits
- Reward legitimate reports
- Transparent enforcement

---

## Implementation Notes

### Security Checklist

```
[ ] All transactions atomic
[ ] Server-side validation only
[ ] Transaction logging implemented
[ ] Rate limiting on all actions
[ ] Alt account detection
[ ] Bot detection mechanisms
[ ] Admin investigation tools
[ ] Automated monitoring/alerts
[ ] Player reporting system
[ ] Clear punishment guidelines
[ ] Appeal process in place
[ ] Regular security audits
[ ] Encrypted database
[ ] Access controls
[ ] Backup/recovery system
```

### Code Security

**Best Practices:**
```csharp
// GOOD: Server validates
[Server]
void TransferMoney(Player from, Player to, int amount) {
    if (from.Balance >= amount && amount > 0) {
        from.Balance -= amount;
        to.Balance += amount;
        LogTransaction(from, to, amount);
    }
}

// BAD: Client can manipulate
[Client]
void TransferMoney(Player from, Player to, int amount) {
    from.Balance -= amount;  // Can be hacked!
    to.Balance += amount;
}
```

**Validation:**
```csharp
// Always validate inputs
bool ValidateTransaction(int amount) {
    if (amount <= 0) return false;
    if (amount > MAX_TRANSACTION) return false;
    if (from.Balance < amount) return false;
    if (RateLimitExceeded(from)) return false;
    return true;
}
```

### Database Security

**Schema Protection:**
```sql
-- Use foreign keys and constraints
CREATE TABLE transactions (
    id SERIAL PRIMARY KEY,
    from_player_id INT NOT NULL REFERENCES players(id),
    to_player_id INT NOT NULL REFERENCES players(id),
    amount INT NOT NULL CHECK (amount > 0),
    timestamp TIMESTAMP DEFAULT NOW(),
    transaction_hash VARCHAR(64) UNIQUE
);

-- Prevent negative balances
ALTER TABLE players ADD CONSTRAINT positive_balance
    CHECK (balance >= 0);
```

**Audit Triggers:**
```sql
-- Log all balance changes
CREATE TRIGGER balance_change_audit
AFTER UPDATE ON players
FOR EACH ROW
WHEN (OLD.balance != NEW.balance)
EXECUTE FUNCTION log_balance_change();
```

### Events to Log

```
OnMoneyCreated(amount, source, player_id)
OnMoneyDestroyed(amount, sink, player_id)
OnTransaction(from, to, amount, type)
OnSuspiciousActivity(player_id, reason, details)
OnExploitDetected(player_id, exploit_type, evidence)
OnBanIssued(player_id, reason, duration)
```

---

## Continuous Improvement

**Regular Reviews:**
- Weekly: Review reports and bans
- Monthly: Analyze exploit trends
- Quarterly: Security audit
- Annually: Full system review

**Update Security:**
- Patch discovered exploits immediately
- Add new detection methods
- Improve monitoring
- Learn from other servers/games

**Community Feedback:**
- Ask players about balance
- Listen to exploit reports
- Reward helpful players
- Transparent about fixes (without revealing details)
