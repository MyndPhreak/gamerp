@using Sandbox.UI;
@using GameRP.Interactions;
@using System;

@inherits Panel

<root>
    <div class="interaction-container">
        <div class="interaction-content">
            @if (ParentPanel != null && ParentPanel.HoldDuration > 0)
            {
                <div class="progress-ring">
                    <svg width="80" height="80">
                        <circle class="progress-ring-bg" cx="40" cy="40" r="34" />
                        <circle class="progress-ring-fill"
                                cx="40" cy="40" r="34"
                                style="stroke-dashoffset: @GetStrokeDashOffset()" />
                    </svg>
                    <div class="progress-key">E</div>
                </div>
            }
            else
            {
                <div class="instant-key">E</div>
            }
            <label class="interaction-text">@ParentPanel?.InteractionText</label>
        </div>
    </div>
</root>

@code
{
    private InteractionPromptPanel ParentPanel => Parent as InteractionPromptPanel;

    private float GetStrokeDashOffset()
    {
        if (ParentPanel == null) return 213.6f;

        var circumference = 2f * MathF.PI * 34f; // 2 * pi * radius
        var progress = ParentPanel.HoldProgress;
        return circumference * (1f - progress);
    }

    protected override int BuildHash() => System.HashCode.Combine(ParentPanel?.HoldProgress, ParentPanel?.InteractionText);
}
