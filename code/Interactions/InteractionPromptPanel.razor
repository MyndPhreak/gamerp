@using Sandbox;
@using Sandbox.UI;
@using GameRP.Interactions;
@using System;

@namespace GameRP.Interactions
@inherits PanelComponent

<root>
    @if (Interactable != null && Interactable.IsLookingAt)
    {
        <div class="interaction-container">
            <div class="interaction-content">
                <div class="key-container">
                    @if (Interactable.HoldDuration > 0)
                    {
                        <div class="progress-circle" style="background: conic-gradient(#34c759 0% @(Interactable.HoldProgress * 100)%, rgba(255,255,255,0.2) @(Interactable.HoldProgress * 100)% 100%)"></div>
                    }
                    <div class="key-letter">E</div>
                </div>

                <div class="text-label">@Interactable.InteractionText</div>
            </div>
        </div>
    }
</root>

@code
{
    [Property] public Interactable Interactable { get; set; }
    [Property] public Vector2 PanelSize { get; set; } = new Vector2(600, 400);

    private Sandbox.WorldPanel _worldPanel;

    protected override void OnEnabled()
    {
        base.OnEnabled();

        // Create WorldPanel component on the same GameObject
        _worldPanel = Components.GetOrCreate<Sandbox.WorldPanel>();
        _worldPanel.PanelSize = PanelSize;
    }

    protected override int BuildHash()
    {
        return System.HashCode.Combine(
            Interactable?.IsLookingAt,
            Interactable?.HoldProgress,
            Interactable?.InteractionText
        );
    }
}
