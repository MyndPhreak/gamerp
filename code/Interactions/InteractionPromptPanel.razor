@using Sandbox;
@using Sandbox.UI;
@using GameRP.Interactions;
@using System;

@namespace GameRP.Interactions
@inherits PanelComponent

<root>
    @if (Interactable != null && Interactable.IsLookingAt)
    {
        <div class="interaction-container">
            <div class="interaction-content">
                @if (Interactable.HoldDuration > 0)
                {
                    <div class="progress-ring">
                        <svg width="80" height="80" style="position: absolute; top: 0; left: 0; transform: rotate(-90deg);">
                            <circle cx="40" cy="40" r="34"
                                    fill="none"
                                    stroke="rgba(255, 255, 255, 0.1)"
                                    stroke-width="6" />
                            <circle cx="40" cy="40" r="34"
                                    fill="none"
                                    stroke="#34c759"
                                    stroke-width="6"
                                    stroke-linecap="round"
                                    stroke-dasharray="213.6"
                                    stroke-dashoffset="@(213.6f * (1f - Interactable.HoldProgress))"
                                    style="transition: stroke-dashoffset 0.1s linear;" />
                        </svg>
                        <label class="progress-key">E</label>
                    </div>
                }
                else
                {
                    <div class="instant-key">
                        <label>E</label>
                    </div>
                }
                <label class="interaction-text">@Interactable.InteractionText</label>
            </div>
        </div>
    }
</root>

@code
{
    [Property] public Interactable Interactable { get; set; }
    [Property] public Vector2 PanelSize { get; set; } = new Vector2(400, 150);

    private Sandbox.WorldPanel _worldPanel;

    protected override void OnEnabled()
    {
        base.OnEnabled();

        // Create WorldPanel component on the same GameObject
        _worldPanel = Components.GetOrCreate<Sandbox.WorldPanel>();
        _worldPanel.PanelSize = PanelSize;
    }

    protected override int BuildHash()
    {
        return System.HashCode.Combine(
            Interactable?.IsLookingAt,
            Interactable?.HoldProgress,
            Interactable?.InteractionText
        );
    }
}
